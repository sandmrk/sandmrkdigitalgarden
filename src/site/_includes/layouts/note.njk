---
permalink: "notes/{{ page.fileSlug | slugify }}/"
---
<!DOCTYPE html>
<html lang="{{ meta.mainLanguage }}">
  <head>
    <title>{% if title %}{{ title }}{% else %}{{ page.fileSlug }}{% endif %}</title>
    {%include "components/pageheader.njk"%}
    {% for imp in dynamics.common.head %}
      {% include imp %}
    {% endfor %}
    {% for imp in dynamics.notes.head %}
      {% include imp %}
    {% endfor %}
  </head>
  <body class="theme-{{meta.baseTheme}} markdown-preview-view markdown-rendered markdown-preview-section {% if settings.dgShowFileTree !== true %}no-filetree{% endif %} {% if settings.dgHomeLink === true and settings.dgShowFileTree !== true %}has-navbar{% endif %} {{meta.bodyClasses}}">
    {%include "components/notegrowthhistory.njk"%}
    
    {% if settings.dgShowFileTree !== true %}
      {%include "components/navbar.njk"%}
    {%else%}
      {%include "components/filetree.njk"%}
    {% endif %}

    {% if settings.dgEnableSearch === true %}
      {%include "components/searchContainer.njk"%}
    {% endif %}

    <main class="content cm-s-obsidian {{contentClasses}}">
      <header>
        {% if settings.dgShowInlineTitle === true %}
          <h1 data-note-icon="{% if noteIcon %}{{noteIcon}}{% else %}{{meta.noteIconsSettings.default}}{% endif %}">{% if title %}{{ title }}{% else %}{{ page.fileSlug }}{% endif %}</h1>
        {% endif %}
        <div class="header-meta">
          {% if settings.dgShowTags === true and tags %}
            <div class="header-tags">
              {% for tag in tags %}
                {% if tag != 'gardenEntry' and tag !='note' %}
                  <a class="tag" onclick="toggleTagSearch(this)">#{{tag}}</a>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
          {%- if meta.timestampSettings.showCreated or meta.timestampSettings.showUpdated -%}
          <div class="timestamps">
            {%- if meta.timestampSettings.showCreated and created -%}
            <div><i data-lucide="calendar-plus"></i> <span class="human-date" data-date="{{created}}"></span></div>
            {%- endif -%}
            {%- if meta.timestampSettings.showUpdated and updated -%}
            <div><i data-lucide="calendar-clock"></i> <span class="human-date" data-date="{{updated}}"></span></div>
            {%- endif -%}
          </div>
          {%- endif -%}
        </div>
      </header>

      {% for imp in dynamics.notes.beforeContent %}
        {% include imp %}
      {% endfor %}

      <div id="note-content-area">
        {{ content | hideDataview | taggify | link | safe}}
      </div>

      <button id="back-to-top" title="è¿”å›é¡¶éƒ¨">â†‘</button>

      <div id="cgfan-comments" style="margin-top: 50px;">
          <hr style="border:none; border-top:1px dashed #e8f5e9; margin-bottom: 30px;">
          <div id="waline"></div>
      </div>
    </main>

    {% if settings.dgShowBacklinks === true or settings.dgShowLocalGraph === true or settings.dgShowToc === true%}
      {%include "components/sidebar.njk"%}
    {% endif %}

    {% if settings.dgLinkPreview === true %}
      {%include "components/linkPreview.njk"%}
    {% endif %}
    {% include "components/references.njk" %}
    {% include "components/timestamps.njk" %}
    
    {%include "components/lucideIcons.njk"%}

    <script>
    (function() {
        // 1. å›¾ç‰‡åä»£è‡ªæ„ˆé€»è¾‘
        const fixImages = () => {
            const imgs = document.querySelectorAll('.markdown-rendered img, .content img, #tag-results-list img');
            imgs.forEach(img => {
                const src = img.getAttribute('src');
                if (src && src.includes('twimg.com') && !src.includes('images.weserv.nl')) {
                    img.setAttribute('src', `https://images.weserv.nl/?url=${encodeURIComponent(src)}`);
                    img.onerror = function() { this.style.display = 'none'; };
                }
            });
        };

        // 2. æ ‡ç­¾é¡µæ¸²æŸ“é€»è¾‘
        const handleTagPage = () => {
            const isTagPage = window.location.pathname.includes('/tag/');
            if (!isTagPage) {
                fixImages();
                return;
            }

            const params = new URLSearchParams(window.location.search);
            const targetTag = params.get('tag');
            if (!targetTag) return;

            // é”å®šå†…å®¹åŒºåŸŸå¹¶é‡ç»„
            const mainContent = document.querySelector('main.content');
            if (mainContent && !document.getElementById('tag-results-list')) {
                mainContent.innerHTML = `
                    <div style="text-align:center; padding: 40px 0;">
                        <div style="background:#e8f5e9; color:#4caf50; display:inline-block; padding:4px 12px; border-radius:20px; font-size:12px; font-weight:800; letter-spacing:1px;">SELECTION</div>
                        <h1 style="margin:10px 0 !important; font-size:2.2rem; color:var(--text-normal);">#<span id="target-tag-name">${targetTag}</span></h1>
                        <a href="/" style="color:#4caf50; text-decoration:none; font-weight:bold; border-bottom:1.5px solid #4caf50; padding-bottom:2px;">â† è¿”å›ç”»å»Šé¦–é¡µ</a>
                    </div>
                    <div id="tag-results-list" style="max-width:800px; margin:0 auto; padding:0 20px 100px;">
                        <p style="text-align:center; color:#999; padding:50px;">æ­£åœ¨æœå¯»çµæ„Ÿç¼“å­˜...</p>
                    </div>
                `;
                // éšè—ä¾§è¾¹æ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const sidebars = document.querySelectorAll('.sidebar');
                sidebars.forEach(s => s.style.display = 'none');
            }

            const rawData = localStorage.getItem('cgfan_gallery_data');
            const container = document.getElementById('tag-results-list');
            
            if (!rawData) {
                container.innerHTML = `
                    <div style="text-align:center; padding:50px; border:1px dashed #eee; border-radius:16px;">
                        <p style="color:#666; margin-bottom:15px;">æœªå‘ç°ç¼“å­˜æ•°æ®ï¼Œè¯·å…ˆè®¿é—®é¦–é¡µåŒæ­¥ã€‚</p>
                        <a href="/" style="background:#4caf50; color:white; padding:8px 20px; border-radius:8px; text-decoration:none; display:inline-block;">ç‚¹å‡»å‰å¾€é¦–é¡µ</a>
                    </div>`;
                return;
            }

            try {
                const allPages = JSON.parse(rawData);
                const normalizedTarget = targetTag.replace('#', '').toLowerCase();
                const filtered = allPages.filter(p => {
                    return p.tags && p.tags.some(t => t.replace('#', '').toLowerCase() === normalizedTarget);
                });

                let htmlRows = "";
                filtered.forEach(p => {
                    const img = p.cover.includes('twimg.com') ? `https://images.weserv.nl/?url=${encodeURIComponent(p.cover)}&w=400` : p.cover;
                    const slug = p.path.split('/').pop().replace('.md','');
                    
                    htmlRows += `
                    <div class="tag-list-card" style="display:flex; margin-bottom:20px; background:#fff; border:1px solid rgba(0,0,0,0.06); border-radius:16px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.03); transition: transform 0.2s ease;">
                        <div style="width:140px; height:140px; flex-shrink:0; background:#f5f5f5;">
                            <img src="${img}" style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <div style="padding:20px; flex-grow:1; display:flex; flex-direction:column; justify-content:center;">
                            <a href="/notes/${slug}/" style="font-weight:700; color:#333; text-decoration:none; font-size:1.15rem; line-height:1.4; margin-bottom:8px;">${p.title}</a>
                            <div style="font-size:12px; color:#999; display:flex; gap:15px;">
                                <span>ğŸ‘¤ ${p.author}</span>
                                <span>ğŸ“… ${p.created}</span>
                            </div>
                        </div>
                    </div>`;
                });
                
                container.innerHTML = filtered.length > 0 ? htmlRows : `<div style="text-align:center;padding:50px;color:#999;">å°šæœªå‘ç° #${targetTag} ç›¸å…³å†…å®¹</div>`;
                fixImages();
            } catch (e) {
                console.error("CGFAN Render Error:", e);
                container.innerHTML = "æ¸²æŸ“å‡ºé”™ï¼Œè¯·åˆ·æ–°ã€‚";
            }
        };

        // 3. è¿è¡Œé€»è¾‘
        handleTagPage();
        // è½®è¯¢è¡¥ä¸ï¼šç¡®ä¿ SPA è·³è½¬åå†…å®¹æ­£ç¡®åŠ è½½
        let runCount = 0;
        const interval = setInterval(() => {
            if (window.location.pathname.includes('/tag/') && !document.querySelector('.tag-list-card')) {
                handleTagPage();
            }
            if (++runCount > 10) clearInterval(interval);
        }, 1000);

        // 4. Waline & è¿”å›é¡¶éƒ¨
        const initWaline = () => {
            if (document.getElementById('waline') && !window.location.pathname.includes('/tag/')) {
                import('https://unpkg.com/@waline/client@v3/dist/waline.js').then(({ init }) => {
                    init({
                        el: '#waline',
                        serverURL: 'https://comments.cgfan.com',
                        lang: 'zh-CN',
                        reaction: true,
                        dark: 'auto',
                        placeholder: 'è¯·ç™»å½•åå‘è¡¨ä½ çš„è¯„è®º...',
                    });
                });
            }
        };
        initWaline();

        const btt = document.getElementById('back-to-top');
        window.addEventListener('scroll', () => {
            btt.style.display = window.scrollY > 500 ? 'flex' : 'none';
        });
        btt.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
    })();
    </script>

    <style>
      #back-to-top {
        position: fixed; bottom: 30px; right: 30px; width: 48px; height: 48px;
        border-radius: 50%; background-color: #4CAF50 !important; color: white !important;
        border: none; cursor: pointer; display: none; align-items: center; justify-content: center;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3); z-index: 9999; font-size: 20px;
        transition: all 0.3s ease;
      }
      .tag-list-card:hover { transform: translateX(8px); border-color: #4CAF50 !important; }
      :root { --waline-theme-color: #4CAF50 !important; }
      /* é’ˆå¯¹ç§»åŠ¨ç«¯éšè—ä¾§è¾¹æ å¹¶è°ƒæ•´å¡ç‰‡ */
      @media (max-width: 600px) {
        .tag-list-card { flex-direction: column !important; height: auto !important; }
        .tag-list-card > div:first-child { width: 100% !important; height: 160px !important; }
      }
    </style>

    {% for imp in dynamics.common.footer %}
      {% include imp %}
    {% endfor %}
    {% for imp in dynamics.notes.footer %}
      {% include imp %}
    {% endfor %}
  </body>
</html>
