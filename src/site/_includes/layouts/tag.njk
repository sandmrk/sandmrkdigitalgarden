{% extends "layouts/base.njk" %}

{% block content %}
<main class="content">
  <header style="text-align: center; margin-bottom: 40px; padding-top: 20px;">
    <h1 style="color: var(--cg-green-vivid); font-size: 2rem;">ğŸ·ï¸ #<span id="target-tag-name">...</span></h1>
    <p style="color: var(--text-muted);">ä¸ºæ‚¨ç²¾é€‰çš„ä¸“é¢˜çµæ„Ÿ</p>
    <a href="/" style="color: var(--cg-green-vivid); text-decoration: none; font-weight: 600;">â† è¿”å›å…¨é‡ç”»å»Š</a>
  </header>

  <div class="grid-view vertical-mode" id="tag-results-container">
    <div id="loading-status" style="text-align: center; padding: 50px; color: var(--text-muted);">
      æ­£åœ¨æœå¯»ç›¸å…³çµæ„Ÿ...
    </div>
  </div>
</main>

<style>
  /* å¼ºåˆ¶å‚ç›´åˆ—è¡¨å¸ƒå±€ */
  .vertical-mode table {
    display: flex !important;
    flex-direction: column !important;
    gap: 20px !important;
    max-width: 800px !important;
    margin: 0 auto !important;
    border: none !important;
  }
  .vertical-mode table tbody { display: contents !important; }
  .vertical-mode table tr {
    display: flex !important;
    flex-direction: row !important; /* æ¨ªå‘æ’å¸ƒï¼šå›¾å·¦æ–‡å³ */
    height: 180px !important;
    background: #fff !important;
    border: 1px solid rgba(0,0,0,0.06) !important;
    border-radius: 16px !important;
    overflow: hidden !important;
    transition: transform 0.2s ease !important;
  }
  .vertical-mode table tr:hover { transform: translateX(10px); border-color: var(--cg-green-vivid) !important; }
  .vertical-mode td:first-child { width: 280px !important; height: 180px !important; flex-shrink: 0; }
  .vertical-mode td:nth-child(2) { padding: 20px !important; flex-grow: 1; }
  /* éšè—ä¸éœ€è¦çš„åˆ— */
  .vertical-mode td:nth-child(3), .vertical-mode td:nth-child(4) { display: none !important; }
</style>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const urlParams = new URLSearchParams(window.location.search);
    const tag = urlParams.get('tag');
    if (!tag) return;
    document.getElementById('target-tag-name').innerText = tag;

    // é€»è¾‘ï¼šå¼‚æ­¥æŠ“å–é¦–é¡µæ•°æ®å¹¶ç­›é€‰
    try {
        const response = await fetch('/');
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // æ‰¾åˆ°é¦–é¡µçš„æ‰€æœ‰è¡Œ
        const allRows = doc.querySelectorAll('.grid-view table tbody tr');
        const container = document.getElementById('tag-results-container');
        const listBody = document.createElement('table');
        const tbody = document.createElement('tbody');
        
        let found = 0;
        allRows.forEach(row => {
            // æ£€æŸ¥è¯¥è¡Œæ˜¯å¦åŒ…å«ç›®æ ‡æ ‡ç­¾
            if (row.innerText.includes('#' + tag)) {
                const clonedRow = row.cloneNode(true);
                clonedRow.style.display = 'flex'; // ç¡®ä¿æ˜¾ç¤º
                tbody.appendChild(clonedRow);
                found++;
            }
        });

        if (found > 0) {
            listBody.appendChild(tbody);
            container.innerHTML = '';
            container.appendChild(listBody);
        } else {
            document.getElementById('loading-status').innerText = "æœªæ‰¾åˆ°ç›¸å…³æ ‡ç­¾çš„è®°å½•ã€‚";
        }
    } catch (e) {
        document.getElementById('loading-status').innerText = "åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚";
    }
});
const html = await response.text();
console.log("æŠ“å–åˆ°çš„é¦–é¡µå†…å®¹ï¼š", html); // çœ‹è¿™é‡Œè¾“å‡ºçš„å†…å®¹é‡Œæœ‰æ²¡æœ‰ tr æ ‡ç­¾
</script>
{% endblock %}
