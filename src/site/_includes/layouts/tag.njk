<script>
document.addEventListener('DOMContentLoaded', async () => {
    const tag = new URLSearchParams(window.location.search).get('tag');
    if (!tag) return;
    document.getElementById('target-tag-name').innerText = tag;

    try {
        // 1. 抓取首页数据
        const response = await fetch('/');
        const text = await response.text();
        const doc = new DOMParser().parseFromString(text, 'text/html');
        
        // 2. [关键修复] 使用多重选择器定位，防止 ID 冲突
        const allRows = doc.querySelectorAll('.grid-view table tbody tr, #gallery-grid table tbody tr');
        const container = document.getElementById('tag-results-container');
        
        if (allRows.length === 0) {
            console.error("未在首页找到任何卡片行");
            return;
        }

        const listTable = document.createElement('table');
        const listBody = document.createElement('tbody');
        let found = 0;

        allRows.forEach(row => {
            // 3. 增强筛选逻辑：不区分大小写，且只匹配完整的标签
            if (row.innerText.includes('#' + tag)) {
                const clonedRow = row.cloneNode(true);
                // 强制重置样式，防止继承首页的 4 列网格样式
                clonedRow.style.setProperty('display', 'flex', 'important');
                listBody.appendChild(clonedRow);
                found++;
            }
        });

        if (found > 0) {
            listTable.appendChild(listBody);
            container.innerHTML = ''; 
            container.appendChild(listTable);
        } else {
            container.innerHTML = `<div style="text-align:center;padding:50px;">未找到关于 #${tag} 的内容</div>`;
        }
    } catch (e) {
        console.error("抓取失败:", e);
    }
});
</script>
